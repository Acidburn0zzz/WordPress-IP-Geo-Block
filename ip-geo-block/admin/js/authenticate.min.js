/*
 Project: WP-ZEP - Zero-day exploit Prevention for wp-admin
 Copyright (c) 2015-2017 tokkonopapa (tokkonopapa@yahoo.com)
 This software is released under the MIT License.
*/
var IP_GEO_BLOCK_ZEP={init:!1,auth:"ip-geo-block-auth-nonce",nonce:IP_GEO_BLOCK_AUTH.nonce||"",sites:IP_GEO_BLOCK_AUTH.sites||[],redirect:function(e){var g,n=this.sites.length;for(g=0;g<n;++g)if(e&&-1!==e.indexOf(this.sites[g])&&this.nonce)return window.location=e,!0;return!1}};(function(e,g){function n(a){var b=g.createElement("div");b.appendChild(g.createTextNode(a));a=b.innerHTML.replace(/["']/g,function(a){return{'"':"&quot;","'":"&#39;"}[a]});b="";return a}function m(a){a=a?a.toString():"";a=a.match(/^(?:([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return{scheme:a[1]||"",relative:a[2]||"",authority:a[3]||"",path:a[4]||"",query:a[5]||"",fragment:a[6]||""}}function h(a,b){"object"!==typeof a&&(a=m(a||location.href));for(var d=a.query?a.query.split("&"):[],c=d.length;0<c--;)if(0===d[c].indexOf(IP_GEO_BLOCK_ZEP.auth)){d.splice(c,1);break}d.push(IP_GEO_BLOCK_ZEP.auth+"="+encodeURIComponent(b));a.query=d.join("&");return(a.scheme?a.scheme+":":"")+(a.relative+a.path)+(a.query?"?"+a.query:"")+(a.fragment?"#"+a.fragment:"")}function k(a){a=a||location.pathname;a=m(a.toLowerCase());var b=a,d=[];"object"!==typeof b&&(b=m(b));b=b.path;if("/"!==b.charAt(0)){var c=window.location.pathname;b=c.substring(0,c.lastIndexOf("/")+1)+b}b=b.split("/");""===b[b.length-1]&&(b.pop(),b[b.length-1]+="/");for(c in b)b.hasOwnProperty(c)&&"."!==b[c]&&(".."===b[c]?0<d.length&&d.pop():(1>d.length||""!==b[c])&&d.push(b[c]));c=d.join("/").replace(/\/\//g,"/");if(!a.scheme||/^https?$/.test(a.scheme)){if(a.authority&&a.authority!==location.host.toLowerCase())return-1;if((a.scheme||a.path||a.query)&&v.test(c))return 1}return 0}function p(a,b,d){var c=b.split(/\s+/);a.each(function(a){for(a=0;a<c.length;++a){var b=e.trim(c[a]).match(/[^\.]+/i)[0],f=e(this),g=b,b=d,f=e._data(f[0]).events[g],g=b?f.splice(f.delegateCount-1,1)[0]:f.pop();f.splice(b?0:f.delegateCount||0,0,g)}})}function q(){return 1===k(location.pathname)||0<=location.search.indexOf(IP_GEO_BLOCK_ZEP.auth)}function r(){q()&&e("a").each(function(){this.hasAttribute("onClick")||-1!==k(this.getAttribute("href"))||this.setAttribute("onClick","javascript:void(0);return false;")});e("img").each(function(a){a=e(this).attr("src");1===k(a)&&e(this).attr("src",h(a,f))});if("undefined"!==typeof window._wpRevisionsSettings){var a,b=window._wpRevisionsSettings.revisionData,d=b.length;for(a=0;a<d;++a)-1===b[a].restoreUrl.indexOf(IP_GEO_BLOCK_ZEP.auth)&&(window._wpRevisionsSettings.revisionData[a].restoreUrl=h(b[a].restoreUrl,f))}}var v=new RegExp("^(?:"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.admin+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.plugins+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.themes+")(?:.*.php|.*/)?$"),f=IP_GEO_BLOCK_ZEP.nonce,t=function(a){for(var b=a.length;0<b--;)if(-1!==a[b].indexOf("request%5Bbrowse%5D=ip-geo-block-auth")){a[b]="request%5Bbrowse%5D=featured";break}return a},u={"upload.php":function(a){for(var b=a.length;0<b--;)if(-1!==a[b].indexOf("query%5Bip-geo-block-auth-nonce%5D=")){delete a[b];break}return a},"theme-install.php":t,"network/theme-install.php":t};e.ajaxPrefilter(function(a,b,d){1!==k(a.url)||a.url.match(/async-upload\.php$/)||("undefined"!==typeof window.FormData&&a.data instanceof FormData?a.data.append(IP_GEO_BLOCK_ZEP.auth,f):(b=m(a.url),"undefined"===typeof a.data||b.query?a.url=h(b,f):(b=a.data?a.data.split("&"):[],d=location.pathname,d=d.replace(IP_GEO_BLOCK_AUTH.home+IP_GEO_BLOCK_AUTH.admin,""),(d=u.hasOwnProperty(d)?u[d]:null)&&(b=d(b)),b.push(IP_GEO_BLOCK_ZEP.auth+"="+encodeURIComponent(f)),a.data=b.join("&"))))});"undefined"===typeof e.fn.onFirst&&(e.fn.onFirst=function(a,b){var d,c=e(this),f="string"===typeof b;e.fn.on.apply(c,arguments);if("object"===typeof a)for(d in a)a.hasOwnProperty(d)&&p(c,d,f);else"string"===typeof a&&p(c,a,f);return c});e(window).on("error",function(){IP_GEO_BLOCK_ZEP.init||r()});e(function(){r();IP_GEO_BLOCK_ZEP.init=!0});(function(){var a=e(g);a.onFirst("click contextmenu","a",function(a){var b=e(this),c=b.attr("href"),g=b.attr("rel"),l="undefined"!==typeof c?k(c):0;if("contextmenu"===a.type)return!0;if(1===l)return b.attr("href",h(c,!g||0>g.indexOf("nofollow")?f:"nofollow")),!0;if(0===l)return!IP_GEO_BLOCK_ZEP.redirect(h(c,f));if(-1===l&&q()){if("_self"===b.attr("target"))return IP_GEO_BLOCK_ZEP.redirect(h(c,f)),!1;c=n(decodeURIComponent(this.href));c=c.split(";",2).shift();l=window.open();l.document.write('<!DOCTYPE html><html><head><meta name="referrer" content="never" /><meta name="referrer" content="no-referrer" /><meta http-equiv="refresh" content="0; url='+c+'" />'+(e("body").hasClass("webview")?'<script>window.location.replace("'+c+'")\x3c/script>':"")+"</head></html>");l.document.close();a.stopImmediatePropagation();return!1}return!0});a.onFirst("submit","form",function(a){a=e(this);var b=a.attr("action");1===k(b)&&a.attr("action",h(b,f))})})()})(jQuery,document);