/*
 Project: WP-ZEP - Zero-day exploit Prevention for wp-admin
 Copyright (c) 2015-2017 tokkonopapa (tokkonopapa@yahoo.com)
 This software is released under the MIT License.
*/
(function(e,k,p){function w(a){var c=p.createElement("div");c.appendChild(p.createTextNode(a));a=c.innerHTML.replace(/["']/g,function(a){return{'"':"&quot;","'":"&#39;"}[a]});c="";return a}function n(a){a=a?a.toString():"";a=a.match(/^(?:([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return{scheme:a[1]||"",relative:a[2]||"",authority:a[3]||"",path:a[4]||"",query:a[5]||"",fragment:a[6]||""}}function l(a,c){"object"!==typeof a&&(a=n(a||location.href));for(var b=a.query?a.query.split("&"):[],f=b.length;0<f--;)if(0===b[f].indexOf(d.auth)){b.splice(f,1);break}b.push(d.auth+"="+encodeURIComponent(c));a.query=b.join("&");return(a.scheme?a.scheme+":":"")+(a.relative+a.path)+(a.query?"?"+a.query:"")+(a.fragment?"#"+a.fragment:"")}function m(a){a=a||location.pathname;a=n(a.toLowerCase());var c,b=a,f=[];"object"!==typeof b&&(b=n(b));b=b.path;if("/"!==b.charAt(0)){var g=k.location.pathname;b=g.substring(0,g.lastIndexOf("/")+1)+b}b=b.split("/");""===b[b.length-1]&&(b.pop(),b[b.length-1]+="/");for(g in b)b.hasOwnProperty(g)&&"."!==b[g]&&(".."===b[g]?0<f.length&&f.pop():(1>f.length||""!==b[g])&&f.push(b[g]));g=f.join("/").replace(/\/\//g,"/");if(!a.scheme||/^https?$/.test(a.scheme)){if(a.authority&&a.authority!==location.host.toLowerCase())return-1;if((a.scheme||a.path||a.query)&&(c=x.exec(g))&&(IP_GEO_BLOCK_AUTH.zep.ajax&&0<=c[0].indexOf(IP_GEO_BLOCK_AUTH.admin+"admin-")||IP_GEO_BLOCK_AUTH.zep.admin&&0<=c[0].indexOf(IP_GEO_BLOCK_AUTH.admin)||IP_GEO_BLOCK_AUTH.zep.plugins&&0<=c[0].indexOf(IP_GEO_BLOCK_AUTH.plugins)||IP_GEO_BLOCK_AUTH.zep.themes&&0<=c[0].indexOf(IP_GEO_BLOCK_AUTH.themes)))return 1}return 0}function q(){return 1===m(location.pathname)||0<=location.search.indexOf(d.auth)}function r(a,c,b){var f=c.split(/\s+/);a.each(function(a){for(a=0;a<f.length;++a){var c=e.trim(f[a]).match(/[^\.]+/i)[0],d=e(this),g=c;c=b;d=e._data(d[0]).events[g];g=c?d.splice(d.delegateCount-1,1)[0]:d.pop();d.splice(c?0:d.delegateCount||0,0,g)}})}function t(){q()&&e("a").each(function(){this.hasAttribute("onClick")||-1!==m(this.getAttribute("href"))||this.setAttribute("onClick","javascript:return false")});e("img").each(function(a){a=e(this).attr("src");1===m(a)&&e(this).attr("src",l(a,d.nonce))});if("undefined"!==typeof k._wpRevisionsSettings){var a,c=k._wpRevisionsSettings.revisionData,b=c.length;for(a=0;a<b;++a)-1===c[a].restoreUrl.indexOf(d.auth)&&(k._wpRevisionsSettings.revisionData[a].restoreUrl=l(c[a].restoreUrl,d.nonce))}}var d={init:!1,auth:"ip-geo-block-auth-nonce",nonce:IP_GEO_BLOCK_AUTH.nonce||"",sites:IP_GEO_BLOCK_AUTH.sites||[]},x=new RegExp("^(?:"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.admin+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.plugins+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.themes+")(?:.*.php|.*/)?$"),u=function(a){for(var c=a.length;0<c--;)if(-1!==a[c].indexOf("request%5Bbrowse%5D=ip-geo-block-auth")){a[c]="request%5Bbrowse%5D=featured";break}return a},v={"upload.php":function(a){for(var c=a.length;0<c--;)if(-1!==a[c].indexOf("query%5Bip-geo-block-auth-nonce%5D=")){delete a[c];break}return a},"theme-install.php":u,"network/theme-install.php":u};e.ajaxPrefilter(function(a,c,b){1!==m(a.url)||a.url.match(/async-upload\.php$/)||("undefined"!==typeof k.FormData&&a.data instanceof FormData?a.data.append(d.auth,d.nonce):(c=n(a.url),"undefined"===typeof a.data||c.query?a.url=l(c,d.nonce):(c=a.data?a.data.split("&"):[],b=location.pathname,b=b.replace(IP_GEO_BLOCK_AUTH.home+IP_GEO_BLOCK_AUTH.admin,""),(b=v.hasOwnProperty(b)?v[b]:null)&&(c=b(c)),c.push(d.auth+"="+encodeURIComponent(d.nonce)),a.data=c.join("&"))))});"undefined"===typeof e.fn.onFirst&&(e.fn.onFirst=function(a,c){var b,f=e(this),d="string"===typeof c;e.fn.on.apply(f,arguments);if("object"===typeof a)for(b in a)a.hasOwnProperty(b)&&r(f,b,d);else"string"===typeof a&&r(f,a,d);return f});(function(){var a=e(p);a.onFirst("click contextmenu","a",function(a){var b=e(this),c=b.attr("href"),g=b.attr("rel"),h=n(c);h=h.scheme||h.path||h.query?m(c):0;if("click"===a.type)if(1===h)b.attr("href",l(c,!g||0>g.indexOf("nofollow")?d.nonce:"nofollow"));else if(-1===h&&q())if("_self"===b.attr("target"))for(a=c,c=d.sites.length,b=0;b<c;++b)a&&0<=a.indexOf(d.sites[b])&&d.nonce&&(k.location=l(a,d.nonce));else return c=w(decodeURIComponent(this.href)),c=c.split(";",2).shift(),h=k.open(),h.document.write('<!DOCTYPE html><html><head><meta name="referrer" content="never" /><meta name="referrer" content="no-referrer" /><meta http-equiv="refresh" content="0; url='+c+'" />'+(e("body").hasClass("webview")?'<script>window.location.replace("'+c+'")\x3c/script>':"")+"</head></html>"),h.document.close(),a.stopImmediatePropagation(),!1});a.onFirst("submit","form",function(a){a=e(this);var b=a.attr("action");1===m(b)&&a.attr("action",l(b,d.nonce))})})();e(k).on("error",function(){d.init||t()});e(function(){t();d.init=!0})})(jQuery,window,document);