/*
 Project: WP-ZEP - Zero-day exploit Prevention for wp-admin
 Copyright (c) 2015-2017 tokkonopapa (tokkonopapa@yahoo.com)
 This software is released under the MIT License.
*/
var IP_GEO_BLOCK_ZEP={init:!1,auth:"ip-geo-block-auth-nonce",nonce:IP_GEO_BLOCK_AUTH.nonce||"",redirect:function(e){-1!==location.href.indexOf(e)&&(this.nonce&&(e+=(0<=e.indexOf("?")?"&":"?")+this.auth+"="+this.nonce),window.location.href=e)}};(function(e,m){function u(a){var b=m.createElement("div");b.appendChild(m.createTextNode(a));a=b.innerHTML.replace(/["']/g,function(a){return{'"':"&quot;","'":"&#39;"}[a]});b="";return a}function g(a){a=a?a.toString():"";a=a.match(/^(?:([^:\/?#]+):)?(\/\/([^\/?#]*))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/);return{scheme:a[1]||"",relative:a[2]||"",authority:a[3]||"",path:a[4]||"",query:a[5]||"",fragment:a[6]||""}}function l(a,b){"object"!==typeof a&&(a=g(a||location.href));for(var c=a.query?a.query.split("&"):[],d=c.length;0<d--;)if(0===c[d].indexOf(IP_GEO_BLOCK_ZEP.auth)){c.splice(d,1);break}c.push(IP_GEO_BLOCK_ZEP.auth+"="+encodeURIComponent(b));a.query=c.join("&");return(a.scheme?a.scheme+":":"")+(a.relative+a.path)+(a.query?"?"+a.query:"")+(a.fragment?"#"+a.fragment:"")}function k(a){a=a||location.pathname;a=g(a.toLowerCase());var b=a,c=[];"object"!==typeof b&&(b=g(b));b=b.path;if("/"!==b.charAt(0)){var d=window.location.pathname;b=d.substring(0,d.lastIndexOf("/")+1)+b}b=b.split("/");""===b[b.length-1]&&(b.pop(),b[b.length-1]+="/");for(d in b)b.hasOwnProperty(d)&&"."!==b[d]&&(".."===b[d]?0<c.length&&c.pop():(1>c.length||""!==b[d])&&c.push(b[d]));d=c.join("/").replace(/\/\//g,"/");if(!a.scheme||/^https?$/.test(a.scheme)){if(a.authority&&a.authority!==location.host.toLowerCase())return-1;if((a.scheme||a.path||a.query)&&v.test(d))return 1}return 0}function n(a,b,c){var d=b.split(/\s+/);a.each(function(a){for(a=0;a<d.length;++a){var b=e.trim(d[a]).match(/[^\.]+/i)[0],h=e(this),f=b,b=c,h=e._data(h[0]).events[f],f=b?h.splice(h.delegateCount-1,1)[0]:h.pop();h.splice(b?0:h.delegateCount||0,0,f)}})}function p(){return 1===k(location.pathname)||0<=location.search.indexOf(IP_GEO_BLOCK_ZEP.auth)}function q(){var a=IP_GEO_BLOCK_ZEP.nonce;if(a){var b=e("body");b.find("img").each(function(b){b=e(this).attr("src");1===k(b)&&e(this).attr("src",l(b,a))});b.onFirst("click contextmenu","a",function(b){var d=e(this),c=d.attr("href"),f=d.attr("rel"),g="undefined"!==typeof c?k(c):0;if(1===g)d.attr("href",l(c,!f||0>f.indexOf("nofollow")?a:"nofollow"));else if(-1===g&&p())return c=u(decodeURIComponent(this.href)),c=c.split(";",2).shift(),f=window.navigator.userAgent.toLowerCase(),f=-1!==f.indexOf("msie")||-1!==f.indexOf("trident"),d=window.open(),d.document.write('<!DOCTYPE html><html><head><meta name="referrer" content="never" /><meta name="referrer" content="no-referrer" /><meta http-equiv="refresh" content="0; url='+c+'" />'+(f?"":'<script>window.location.replace("'+c+'")\x3c/script>')+"</head></html>"),d.document.close(),b.stopImmediatePropagation(),!1});b.onFirst("submit","form",function(b){b=e(this);var c=b.attr("action");1===k(c)&&b.attr("action",l(c,a))});if("undefined"!==typeof window._wpRevisionsSettings)for(var c=window._wpRevisionsSettings.revisionData,d=c.length,b=0;b<d;++b)-1===c[b].restoreUrl.indexOf(IP_GEO_BLOCK_ZEP.auth)&&(window._wpRevisionsSettings.revisionData[b].restoreUrl=l(c[b].restoreUrl,a))}}var v=new RegExp("^(?:"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.admin+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.plugins+"|"+(IP_GEO_BLOCK_AUTH.home||"")+IP_GEO_BLOCK_AUTH.themes+")(?:.*.php|.*/)?$"),r=function(a){for(var b=a.length;0<b--;)if(-1!==a[b].indexOf("request%5Bbrowse%5D=ip-geo-block-auth")){a[b]="request%5Bbrowse%5D=featured";break}return a},t={"upload.php":function(a){for(var b=a.length;0<b--;)if(-1!==a[b].indexOf("query%5Bip-geo-block-auth-nonce%5D=")){delete a[b];break}return a},"theme-install.php":r,"network/theme-install.php":r};e.ajaxPrefilter(function(a,b,c){if((b=IP_GEO_BLOCK_ZEP.nonce)&&1===k(a.url)&&!a.url.match(/async-upload\.php$/))if("undefined"!==typeof window.FormData&&a.data instanceof FormData)a.data.append(IP_GEO_BLOCK_ZEP.auth,b);else if(c=g(a.url),"undefined"===typeof a.data||c.query)a.url=l(c,b);else{c=a.data?a.data.split("&"):[];var d=location.pathname;d=d.replace(IP_GEO_BLOCK_AUTH.home+IP_GEO_BLOCK_AUTH.admin,"");(d=t.hasOwnProperty(d)?t[d]:null)&&(c=d(c));c.push(IP_GEO_BLOCK_ZEP.auth+"="+encodeURIComponent(b));a.data=c.join("&")}});"undefined"===typeof e.fn.onFirst&&(e.fn.onFirst=function(a,b){var c,d=e(this),f="string"===typeof b;e.fn.on.apply(d,arguments);if("object"===typeof a)for(c in a)a.hasOwnProperty(c)&&n(d,c,f);else"string"===typeof a&&n(d,a,f);return d});e(function(){p()&&e("a").each(function(){this.hasAttribute("onClick")||-1!==k(this.getAttribute("href"))||this.setAttribute("onClick","javascript:void(0);return false;")});q();IP_GEO_BLOCK_ZEP.init=!0});e(window).on("error",function(){IP_GEO_BLOCK_ZEP.init||q()})})(jQuery,document);